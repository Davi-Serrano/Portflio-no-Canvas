<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Davi Serrano</title>
</head>
<style>
	html, body{
		margin: 0;
		padding: 0;
		overflow: hidden;

	
	}

</style>
<body>
    <canvas width="3500" height="800">  </canvas>


    <script>
        //Variáveis
		//Código das setas do teclado
		var UP = 38, DOWN = 40, LEFT = 37, RIGHT = 39;
		//Variáveis de movimentação
		var moveEsquerda = false, moveDireita = false, moveCima = false, moveBaixo = false;
		//Referência ao canvas
		var cnv = document.querySelector("canvas");
		//dispositivo através do qual desenhamos no canvas
		var ctx = cnv.getContext("2d");
		//Nave
		var nave = new Image();
		nave.src = "IMG/Nave.png"
		//Fundo de tela
		var FundoImg = new Image();
		FundoImg.src = "IMG/fundo.jpg"
		//Objetos
		var sprites = [];
		
		var gameWorld = {
			img: FundoImg,
			x:0,
			y:0,
			width: 3500,
			height: 800,

		};
		sprites.push(gameWorld);

		var p1 = {
			img: nave,
			x: 0,
			y: 0,
			width: 320,
			height: 168,

		}
		// sprites.push(char)
		
		//Câmera
		var cam = {
			x:0,
			y:0,
			width: cnv.width,
			height: cnv.height,

			leftEdge: function(){
				return this.x + (this.width * 0.5);
			},
			rightEdge: function(){
				return this.x + (this.width * 0.5);
			},
			topEdge: function(){
				return this.y + (this.height * 0.5);
			},
			bottomEdge: function(){
				return this.y + (this.height * 0.5);
			}
		};
		// //Posição inicail Nave
		p1.x = 900
		p1.y = 200

		//Inicia o loop de animação
		update();

		//Dispara um evento quando uma tecla é pressionada
		window.addEventListener("keydown",keydownHandler);
		//Dispara um evento quando uma tecla é liberada
		window.addEventListener("keyup",keyupHandler);

		//Evento disparado pela tecla pressionada
		function keydownHandler(e){
			//Variável recebe o código da tecla pressionada
			var key = e.keyCode;
			//Esquerda
			if(key === LEFT && key !== RIGHT){
				moveEsquerda = true;
			}
			//Direita
			if(key === RIGHT && key !== LEFT){
				moveDireita = true;
			}
			//Para Cima
			if(key === UP && key !== DOWN){
				moveCima = true;
			}
			//Para Baixo
			if(key === DOWN && key !== UP){
				moveBaixo = true;
			}
				
		}

		//Evento disparado pela tecla liberada
		function keyupHandler(e){
			//Variável recebe o código da tecla liberada
			var key = e.keyCode;
			//Esquerda
			if(key === LEFT && key !== RIGHT){
				moveEsquerda = false;
			}
			//Direita
			if(key === RIGHT && key !== LEFT){
				moveDireita = false;
			}
			//Para Cima
			if(key === UP && key !== DOWN){
				moveCima = false;
			}
			//Para Baixo
			if(key === DOWN && key !== UP){
				moveBaixo = false;
			}
		
		}

		//Função que atualiza os parâmetros de posicionamento do objeto nos eixos X e Y
		function move(){
			//Move para a esquerda
			if(moveEsquerda){
				p1.x-=2;
			}
			//Move para a direita
			if(moveDireita){
				p1.x+= 2;
				
			}
			//Move para cima
			if(moveCima){
				p1.y-=2;
			}
			//Move para baixo
			if(moveBaixo){
				p1.y+=2;
			}
			//Limite de telas
			if( p1.x < 0){
				p1.x =- 0;
			}
			if(p1.y < 0){
				p1.y =- 0;
			}
			//Easter Egg do Buraco de minhoca
			if(p1.y === cnv.height || p1.x === cnv.width){
				alert("Perigo!! Você entrou em um buraco de minhoca, sua nave pode apresentar mal funcionamento, atualize a página para concertar!!")
				document.location.reload(true);
			}
			//Atualizar a posição da câmera em função do char
			if(p1.x < cam.leftEdge()){
				cam.x = p1.x - (cam.width * 0.25);
			}
			if(p1.x + p1.width > cam.rightEdge()){
				cam.x = p1.x + p1.width - (cam.width * 0.75);
			}
			if(p1.y < cam.topEdge()){
				cam.y = p1.y - (cam.height * 0.25);
			}
			if(p1.y + p1.height > cam.bottomEdge()){
				cam.y = p1.y + p1.height - (cam.height * 0.75);
			}
			// Limite da camera
			if(cam.x < 0){
				cam.x = 0;
			}
			if(cam.y < 0){
				cam.y = 0;
			}
			if(cam.y + cam.height > gameWorld.height){
				cam.y = gameWorld.height - cam.height;
			}
		
		
		}

		//Função que desenha o objeto na tela de acordo com os parâmetros de posicionamento do objeto
		function render(){
			ctx.save();
			ctx.translate(-cam.x, -cam.y);
			for (var i in sprites){
				var spr = sprites[i];
				//Desenha o objeto em função de p1.x e p1.y
				ctx.drawImage(spr.img, 0, 0, spr.width, spr.height, spr.x, spr.y, spr.width, spr.height);
				//Desenha o fundo na tela
				ctx.drawImage(nave, p1.x, p1.y);
			}
			ctx.restore();
		}
		
		//Loop de animação
		function update(){
			//Solicita ao navegador uma animação passando a função e o elemento a ser animado
			requestAnimationFrame(update, cnv);
			//Atualiza os dados do objeto
			move();
			//Desenha o objeto atualizado
			render();
		
		}

	

    </script>

</body>
</html>